# Tutorial: gRPC Payment Service

This mini-tutorial demonstrates implementing a payment service with gRPC (see lecture slides).

You are encouraged to look around
and try things out:
- build, run, and familiarize yourself with the project; check out the code generated by gRPC
- change the service definition to implement new RPCs

## Prerequisites
- JDK 21+
- Gradle 8.5+

## Project Structure

```shell
├── app
│   └── src
│       ├── main
│       │   ├── java
│       │   │   └── ch/unisg/scs/ds
│       │   │                    ├── PaymentClient.java # Client implementation (sends RPC via stub)
│       │   │                    ├── PaymentServer.java # Server implementation
│       │   │                    └── PaymentServiceImpl.java # Payment service implementation
│       │   ├── proto
│       │   │   └── payment.proto ## Payment service definition
│       │   └── resources
│       └── test
```

## Payment Service Definition

You can find the definition of the payment service in the
[payment.proto](src/main/proto/payment.proto) file under [src/main/proto](src/main/proto):

```protobuf
syntax = "proto3";

option java_package = "ch.unisg.scs.ds";

// Defines the service. A service can have multiple RPCs.
service PaymentService {
  // Defines the RPC for processing payments
  rpc processPayment(PaymentRequest) returns (PaymentResponse) {}
}

// Request payload
message PaymentRequest {
  string card_number = 1;
  string card_expiry_date = 2;
  string card_cvc = 3;
  double payment_amount = 4;
  string payment_currency = 5;
}

// Response payload
message PaymentResponse {
  string paymentId = 1;
}
```

The service defines one unary RPC for processing payments. The request payload includes the card
details, the payment amount, and the payment currency.

## How to Build

When you build the project, gRPC will generate the code for client and server stubs based on the
payment service definition. After building the project, you will find the code under
`build/generated/source/proto`. Feel free to look into it!

To clone the project:

```shell
git clone git@github.com:HSG-DS-HS24/grpc-payment.git
```

To build the project:

```shell
./gradlew build
```

To clean up the project and remove the code generated by gRPC:

```shell
./gradlew clean
```

## How to Run

To run the project, you will need two terminal windows:
- one for running the server
- one for running a client

Run the server by executing the following Gradle task:

```shell
./gradlew runServer
```

In a new terminal window, run the client by executing the following Gradle task:

```shell
./gradlew runClient
```

The Gradle tasks are defined in [build.gradle](build.gradle).
